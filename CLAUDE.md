# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

OpenMuscle FlexGrid is an **open-source hardware design project** for a modular 60-sensor pressure-sensing wearable platform. This is a **KiCad PCB design repository**, not firmware/software.

- **License:** CERN-OHL-S-2.0 (hardware), MIT (firmware)
- **MCU:** ESP32-S3-WROOM-1-N16R8
- **Purpose:** Forearm-based pressure sensing for prosthetics, exosuits, and biomechanical research

## Architecture

**Two-board modular design:**

1. **Flexible PCB** (`OM-FlexGrid-Flex/`) - Wraps around forearm with 15×4 Velostat sensor matrix (60 sensors total)
2. **Rigid PCB** (`OM-FlexGrid-Rigid-PCB/`) - Main controller board with ESP32-S3, power management, display, and interfaces

**Sensor Matrix Operation:**
- CD74HC4067 multiplexer cycles through 15 columns (connected to 3.3V one at a time)
- 4 row lines with 10kΩ pull-down resistors read via ESP32 ADC1
- Velostat pads act as pressure-sensitive resistors
- 60 readings per scan frame

## Repository Structure

```
KiCad/
├── OM-FlexGrid V0/    # Original prototype
├── OM-FlexGrid V1/    # First production revision
└── OM-FlexGrid V2/    # Current development version (active)
    ├── OM-FlexGrid-Flex/
    │   ├── OM-FlexGrid-Flex.kicad_sch
    │   ├── OM-FlexGrid-Flex.kicad_pcb
    │   └── *Gerber.zip          # Fabrication files
    └── OM-FlexGrid-Rigid-PCB/
        ├── OM-FlexGrid-Rigid-PCB.kicad_sch
        ├── OM-FlexGrid-Rigid-PCB.kicad_pcb
        └── *Gerber/             # Fabrication files
BOM/                   # Bill of Materials (CSV/XLSX)
Schematics/            # Exported schematic images/PDFs
```

## Key Hardware Components (Rigid PCB)

| Component | Part | Function |
|-----------|------|----------|
| MCU | ESP32-S3-WROOM-1-N16R8 | Main controller (16MB Flash, 8MB PSRAM, USB+BLE) |
| Multiplexer | CD74HC4067 | 16-channel analog mux (15 columns) |
| Display | SSD1306 128×32 | OLED over I2C |
| IMU | ICM-42688-P | 6-DOF sensor (optional) |
| LDO | TPS7A0333 | 3.3V regulation |
| Charger | LTC4054 | LiPo battery charging |
| Power Latch | MAX16054 | Soft power on/off |
| Haptic | IRLML2060 MOSFET | Vibration motor driver |

## Related Repositories

- **Firmware:** https://github.com/Open-Muscle/OpenMuscle-Firmware
- **Documentation Hub:** https://github.com/Open-Muscle/OpenMuscle-Hub
- **Project Site:** https://openmuscle.org

## Working with KiCad Files

- Use KiCad 6.0+ to open `.kicad_pro`, `.kicad_sch`, and `.kicad_pcb` files
- Gerber files in `*Gerber/` or `*.zip` are ready for PCB fabrication
- Backup files in `*-backups/` directories are auto-generated by KiCad
